on:
  workflow_call:
    inputs:
      request-error:
        description: Error the job when passed at true
        required: true
        type: string
    secrets:
      token:
        required: false

jobs:
  sub_call:
    runs-on: ubuntu-latest
    steps:
      - name: Debug Event
        run: cat ${{ github.event_path }}

      - name: Simple Message
        run: |
          if [ "${{ inputs.request-error }}" = "true" ]; then
            exit 1
          else
            echo "Hello world"
          fi

      - name: Get last PR author
        id: get_author
        run: |
          echo $GITHUB_TOKEN | gh auth login --with-token
          # See the output
          echo "author::$(gh pr view --repo ${{ github.event.repository.clone_url }} $(gh pr --repo ${{ github.event.repository.clone_url }} list -s merged | head -n1 | awk '{print $1}') | grep 'author:\t' | awk '{print $2}')"
          # Save the output
          echo "::set-output name=author::$(gh pr view --repo ${{ github.event.repository.clone_url }} $(gh pr --repo ${{ github.event.repository.clone_url }} list -s merged | head -n1 | awk '{print $1}') | grep 'author:\t' | awk '{print $2}')"
